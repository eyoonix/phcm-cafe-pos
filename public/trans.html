<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>PHCM POS | Transactions</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
<header class="header">
    <div class="header-brand">
        <img src="/photos/phcm-logo.png" class="header-logo" alt="Logo" /> 
        PHCM CAFETERIA
    </div>
    <a href="dashboard.html" class="btn-primary" style="text-decoration:none;">Dashboard</a>
</header>

<div class="container">
    <h1><i class="fas fa-history"></i> Transaction History</h1>
    <div id="historyContainer" class="history-list"></div>
</div>
</div>

<script>
    const token = localStorage.getItem('pos_token');
    async function loadHistory() {
    const res = await fetch('/api/sales/grouped-history', { 
        headers: { 'Authorization': `Bearer ${token}` } 
    });
    const history = await res.json();
    const container = document.getElementById('historyContainer');
    container.innerHTML = ''; 

    history.forEach((group, index) => {
        const date = new Date(group.created_at).toLocaleString('en-PH', {
            month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
        });

        // Create a card div
        const card = document.createElement('div');
        card.className = "order-card"; 
        
        card.innerHTML = `
            <details>
                <summary>
                    <div class="summary-content">
                        <span class="order-id">Order #${history.length - index}</span>
                        <span class="order-date">${date}</span>
                        <span class="badge">${group.item_count} Items</span>
                        <span class="order-total">â‚±${group.grand_total.toFixed(2)}</span>
                        <i class="fas fa-chevron-down toggle-icon"></i>
                    </div>
                </summary>
                <div class="order-details">
                    <h5><i class="fas fa-list"></i> Items Bought</h5>
                    <div class="breakdown-grid">
                        ${group.items_summary.split(',').map(item => `
                            <div class="breakdown-item">${item}</div>
                        `).join('')}
                    </div>
                </div>
            </details>
        `;
        container.appendChild(card);
    });
}
    document.addEventListener('DOMContentLoaded', loadHistory);
</script>
</body>
</html>